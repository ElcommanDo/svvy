<!DOCTYPE html>
<html  dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชูุฑูุฑ ุญุงูุฉ ุงูุตูุจุฉ ุงูุฒุฑุงุนูุฉ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        ul {
    direction: rtl; /* ูุถุจุท ุงุชุฌุงู ุงููุงุฆูุฉ */
    text-align: right; /* ูุถุจุท ุงููุตูุต ุฏุงุฎู ุงููุงุฆูุฉ */
    list-style-position: inside; /* ูุฌุนู ุงูุฑููุฒ ุชุจุฏุฃ ูู ููุณ ุงูุงุชุฌุงู */
}
html {
    direction: rtl;
    unicode-bidi: embed;
}
        body {
            background-color: #f4f4f4;
            font-family: 'Tajawal', sans-serif;
            direction: rtl;
            text-align: right;
        }
        .container {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            max-width: 800px;
        }
        .header {
            background: #28a745;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px 10px 0 0;
        }
        .status-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .progress {
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            width: 100%;
            display: none;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #28a745;
            transition: width 0.5s ease-in-out;
        }
        .alert {
            display: none;
            text-align: center;
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        @media print {
    body {
        direction: rtl; /* ูุฌุนู ุงููุต ุจุงููุงูู ูุจุฏุฃ ูู ุงููููู */
        unicode-bidi: embed;
    }

    ul {
        direction: rtl;
        text-align: right;
        list-style-position: inside;
    }

    li {
        text-align: right;
    }
}

    </style>
</head>
<body>

<!-- โ ุดุฑูุท ุงูุชุญููู ูุฑุณุงูุฉ ุงููุฌุงุญ ูู ุฃุนูู ุงูุตูุญุฉ -->
<div class="container">
    <div class="status-container">
        <p id="loading-text" style="display: none; font-weight: bold;">โณ ุฌุงุฑู ุชุญุถูุฑ ุงูููู...</p>
        <div class="progress">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <div class="alert alert-success" id="success-message">โ ุชู ุชุญููู ุงูููู ุจูุฌุงุญ!</div>
    </div>
</div>

<!-- โ ูุญุชูู ุงูุชูุฑูุฑ -->
<div class="container" id="report-content">
    <div class="header">
        <h2>ุชูุฑูุฑ ุญุงูุฉ ุงูุตูุจุฉ ุงูุฒุฑุงุนูุฉ - ุงููุฑูุงุช</h2>
        <p>๐ ุงูุชุงุฑูุฎ: <span id="current_date"></span></p>
    </div>

    <h4 class="mt-4">๐ ุงูุญุงูุฉ ุงูุญุงููุฉ:</h4>
    <p>๐ก๏ธ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูุฎุงุฑุฌูุฉ: <span id="temp_outside"></span>ยฐC</p>
    <p>๐ง ูุณุจุฉ ุฑุทูุจุฉ ุงูุชุฑุจุฉ: <span id="soil_moisture"></span>%</p>

    <h4 class="mt-4">๐ ุชููุนุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู:</h4>
    <ul>
        <li>ุงุณุชูุฑุงุฑ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงูุฏุงุฎููุฉ ุนูุฏ 25ยฐC ุจูุถู ูุธุงู ุงูุชุญูู.</li>
        <li>ุงุญุชูุงููุฉ ุงุฑุชูุงุน ูุณุจุฉ ุงูุฑุทูุจุฉ ุฅูู 60% ููุง ูุฏ ูุณุชุฏุนู ุชุนุฏููุงุช ุจุณูุทุฉ.</li>
        <li>ุงููุจุงุชุงุช ุณุชุธู ุจุญุงูุฉ ุฌูุฏุฉุ ูุน ุงุญุชูุงููุฉ ุฅุฌูุงุฏ ุฎููู ุจุณุจุจ ุงูุชุบูุฑุงุช.</li>
    </ul>

    <h4 class="mt-4">๐ ุงูุชูุตูุงุช:</h4>
    <ul>
        <li>๐ ูุฑุงูุจุฉ ูุณุจุฉ ุงูุฑุทูุจุฉ ูุถุจุทูุง ุนูุฏ 60%.</li>
        <li>๐จ ุชุญุณูู ุงูุชูููุฉ ูุชุฌูุจ ุงูุฑุทูุจุฉ ุงูุฒุงุฆุฏุฉ.</li>
        <li>๐ฑ ูุชุงุจุนุฉ ุญุงูุฉ ุงููุจุงุชุงุช ุจุดูู ุฏูุฑู ูุงูุชุดุงู ุฃู ุฅุฌูุงุฏ ูุจูุฑูุง.</li>
    </ul>
</div>

<!-- โ ุฒุฑ ุชุญููู ุงูุชูุฑูุฑ -->
<div class="container">
    <div class="download-btn text-center">
        <button class="btn btn-success" onclick="downloadPDF()">
            <i class="fas fa-file-pdf"></i> ุชุญููู ุงูุชูุฑูุฑ ูู PDF
        </button>
    </div>
</div>

<script>
    document.getElementById("temp_outside").innerText = "{{ temperature }}";
    document.getElementById("soil_moisture").innerText = "{{ soil_moisture }}";
    document.getElementById("current_date").innerText = "{{ current_date }}";

    function downloadPDF() {
        const reportContent = document.getElementById("report-content");
        const progressBar = document.getElementById("progress-bar");
        const loadingText = document.getElementById("loading-text");
        const progressContainer = document.querySelector(".progress");
        const successMessage = document.getElementById("success-message");

        // โ ุงูุชูุฑูุฑ ุฅูู ุงูุฃุนูู ุนูุฏ ุจุฏุก ุงูุชุญููู
        window.scrollTo({ top: 0, behavior: "smooth" });

        // โ ุฅุธูุงุฑ ุดุฑูุท ุงูุชุญููู ูุงูุฑุณุงูุฉ
        progressContainer.style.display = "block";
        loadingText.style.display = "block";
        successMessage.style.display = "none";

        let progress = 0;
        let progressInterval = setInterval(() => {
            if (progress >= 100) {
                clearInterval(progressInterval);
            } else {
                progress += 10;
                progressBar.style.width = progress + "%";
            }
        }, 300);

        setTimeout(() => {
            html2pdf(reportContent, {
                margin: 10,
                filename: 'ุชูุฑูุฑ_ุงูุตูุจุฉ_ุงูุฒุฑุงุนูุฉ.pdf',
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    logging: true, 
                    letterRendering: true, 
                    windowWidth: 1000 
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).then(() => {
                clearInterval(progressInterval);
                progressBar.style.width = "100%";

                // โ ุฅุฎูุงุก ุดุฑูุท ุงูุชุญููู ูุฅุธูุงุฑ ุฑุณุงูุฉ ุงููุฌุงุญ
                setTimeout(() => {
                    progressContainer.style.display = "none";
                    loadingText.style.display = "none";
                    successMessage.style.display = "block";
                }, 500);
                
                // โ ุฅุฎูุงุก ุงูุฑุณุงูุฉ ุจุนุฏ 3 ุซูุงูู
                setTimeout(() => {
                    successMessage.style.display = "none";
                }, 3000);
            });
        }, 2000);
    }
</script>

</body>
</html>
